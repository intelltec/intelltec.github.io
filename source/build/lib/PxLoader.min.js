function PxLoader(o){null==(o=o||{}).statusInterval&&(o.statusInterval=5e3),null==o.loggingDelay&&(o.loggingDelay=2e4),null==o.noProgressTimeout&&(o.noProgressTimeout=1/0);function a(n){function a(t){for(var r=t.resource,e=1/0,s=0;s<r.tags.length;s++)for(var a=0;a<Math.min(n.length,e)&&!(r.tags[s]==n[a]&&a<e&&0===(e=a))&&0!==e;a++);return e}return n=t(n),function(t,r){var e=a(t),s=a(r);return e<s?-1:s<e?1:t.priority<r.priority?-1:t.priority>r.priority?1:0}}function r(t,r){for(var e=null,s=0,a=u.length;s<a;s++)if(u[s].resource===t){e=u[s];break}if(null!=e&&e.status===h.WAITING){e.status=r,c=+new Date;t.tags.length;for(var s=0,n=l.length;s<n;s++){var o=l[s],i=0===o.tags.length||t.tags.contains(o.tags);i&&f(e,o)}}}var i,u=[],l=[],c=+new Date,h={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},t=function(t){return null==t?[]:Array.isArray(t)?t:[t]},g=(this.add=function(t){t.tags=new PxLoaderTags(t.tags),null==t.priority&&(t.priority=1/0),u.push({resource:t,status:h.QUEUED})},this.addProgressListener=function(t,r){l.push({callback:t,tags:new PxLoaderTags(r)})},this.addCompletionListener=function(r,t){l.push({tags:new PxLoaderTags(t),callback:function(t){t.completedCount===t.totalCount&&r()}})},this.start=function(t){i=+new Date;t=a(t);u.sort(t);for(var r=0,e=u.length;r<e;r++){var s=u[r];s.status=h.WAITING,s.resource.start(this)}setTimeout(g,100)},function(){for(var t=!1,r=+new Date-c,e=r>=o.noProgressTimeout,r=r>=o.loggingDelay,s=0,a=u.length;s<a;s++){var n=u[s];n.status===h.WAITING&&(n.resource.checkStatus&&n.resource.checkStatus(),n.status===h.WAITING)&&(e?n.resource.onTimeout():t=!0)}r&&t&&T(),t&&setTimeout(g,o.statusInterval)}),f=(this.isBusy=function(){for(var t=0,r=u.length;t<r;t++)if(u[t].status===h.QUEUED||u[t].status===h.WAITING)return!0;return!1},this.onLoad=function(t){r(t,h.LOADED)},this.onError=function(t){r(t,h.ERROR)},this.onTimeout=function(t){r(t,h.TIMEOUT)},function(t,r){for(var e=0,s=0,a=0,n=u.length;a<n;a++){var o=u[a];(0===r.tags.length||o.resource.tags.contains(r.tags))&&(s++,o.status!==h.LOADED&&o.status!==h.ERROR&&o.status!==h.TIMEOUT||e++)}r.callback({resource:t.resource,loaded:t.status===h.LOADED,error:t.status===h.ERROR,timeout:t.status===h.TIMEOUT,completedCount:e,totalCount:s})}),T=this.log=function(t){if(window.console){var r=Math.round((+new Date-i)/1e3);window.console.log("PxLoader elapsed: "+r+" sec");for(var e=0,s=u.length;e<s;e++){var a=u[e];if(t||a.status===h.WAITING){var n="PxLoader: #"+e+" "+a.resource.getName();switch(a.status){case h.QUEUED:n+=" (Not Started)";break;case h.WAITING:n+=" (Waiting)";break;case h.LOADED:n+=" (Loaded)";break;case h.ERROR:n+=" (Error)";break;case h.TIMEOUT:n+=" (Timeout)"}0<a.resource.tags.length&&(n+=" Tags: ["+a.resource.tags.join(",")+"]"),window.console.log(n)}}}}}function PxLoaderTags(t){if(this.array=[],this.object={},this.value=null,this.length=0,null!=t){if(Array.isArray(t))this.array=t;else if("object"==typeof t)for(var r in t)this.array.push(r);else this.array.push(t),this.value=t;this.length=this.array.length;for(var e=0;e<this.length;e++)this.object[this.array[e]]=!0}this.contains=function(t){if(0!==this.length&&0!==t.length){if(1===this.length&&null!==this.value)return 1===t.length?this.value===t.value:t.object.hasOwnProperty(this.value);if(t.length<this.length)return t.contains(this);for(var r in this.object)if(t.object[r])return!0}return!1}}Array.isArray||(Array.isArray=function(t){return"[object Array]"==Object.prototype.toString.call(t)});